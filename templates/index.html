<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GWL CYBER RAT | Intelligence Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --bg: #05070a; --panel: #0d1117; --accent: #ffb400; --text: #e6edf3; --border: #30363d; }
        .light-theme { --bg: #fff5f7; --panel: #ffffff; --accent: #ff4d6d; --text: #1a1a1a; --border: #ffccd5; }
        body { background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        
        /* Terminal Style Welcome */
        #welcome-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; display:flex; justify-content:center; align-items:center; z-index:1000; animation: fadeOut 3s forwards 2.5s; }
        .glitch { font-size: 2rem; color: var(--accent); border-right: 4px solid; width: 0; white-space: nowrap; overflow: hidden; animation: typing 2s steps(30) forwards; }
        
        .top-bar { height: 50px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: var(--panel); }
        .dashboard { display: flex; height: calc(100vh - 50px); }
        
        /* 2:3 Split Layout */
        .left-data { width: 66.6%; padding: 20px; border-right: 1px solid var(--border); overflow-y: auto; }
        .right-ai { width: 33.3%; background: var(--panel); display: flex; flex-direction: column; }
        
        input { width: 90%; padding: 12px; background: #000; border: 1px solid var(--border); color: var(--accent); border-radius: 4px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: var(--accent); color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; }
        
        #chat-window { flex-grow: 1; padding: 15px; overflow-y: auto; font-size: 13px; display: flex; flex-direction: column; gap: 10px; }
        .rat-msg { background: #1f2328; padding: 10px; border-radius: 4px; border-left: 3px solid var(--accent); }
        .user-msg { background: var(--accent); color: #000; padding: 10px; border-radius: 4px; align-self: flex-end; }
        
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
    </style>
</head>
<body>
    <div id="welcome-overlay"><div class="glitch">>> ACCESSING GWL CYBER RAT SYSTEM...</div></div>
    <div class="top-bar">
        <span>GWL <b style="color:var(--accent)">CYBER RAT</b> [ v2.0.1 ]</span>
        <button onclick="document.body.classList.toggle('light-theme')">THEME_TOGGLE</button>
    </div>
    <div class="dashboard">
        <div class="left-data">
            <center>
                <h3>[ INTEL_TRACKER_UI ]</h3>
                <input type="text" id="target" placeholder="TARGET_ID (MOBILE/EMAIL)...">
                <br>
                <button onclick="startTracking()">INITIATE_SURVEILLANCE</button>
                <div id="status-log" style="margin-top:20px; text-align:left; font-size:12px;"></div>
                <pre id="raw-data" style="background:#000; padding:15px; border:1px solid var(--border); color:#00ff41; overflow:auto; display:none; text-align:left;"></pre>
            </center>
        </div>
        <div class="right-ai">
            <div style="padding:10px; border-bottom:1px solid var(--border); text-align:center; font-size:12px;">AI_NEURAL_LINK: CYBER_RAT</div>
            <div id="chat-window">
                <div class="rat-msg"><b>CYBER_RAT:</b> Neural link established. Waiting for target input to begin analysis, Manu.</div>
            </div>
            <div style="padding:10px; border-top:1px solid var(--border); display:flex; gap:5px;">
                <input type="text" id="user-input" style="width:70%; margin:0;" placeholder="Command Cyber Rat...">
                <button onclick="askRat()" style="width:30%;">EXEC</button>
            </div>
        </div>
    </div>
    <script>
        let currentData = null;
        async function startTracking() {
            const q = document.getElementById('target').value;
            const log = document.getElementById('status-log');
            const raw = document.getElementById('raw-data');
            if(!q) return;
            log.innerHTML = "<p style='color:var(--accent)'>[LOG] Contacting node: " + q + "...</p>";
            const fd = new FormData(); fd.append('query', q);
            const r = await fetch('/search', { method: 'POST', body: fd });
            const d = await r.json();
            if(d.status === "success") {
                currentData = d.data;
                log.innerHTML = "<p style='color:green'>[LOG] Asset located. Data stream decrypted.</p>";
                raw.style.display = 'block'; raw.innerText = JSON.stringify(d.data, null, 4);
                addRatMsg("Intel retrieved. Ready for data analysis of target " + q + ".");
            } else {
                log.innerHTML = `<p style='color:red'>[ERROR] ${d.msg}</p>`;
            }
        }
        async function askRat() {
            const msg = document.getElementById('user-input').value;
            if(!msg) return;
            const win = document.getElementById('chat-window');
            win.innerHTML += `<div class="user-msg">${msg}</div>`;
            document.getElementById('user-input').value = "";
            const r = await fetch('/ask_rat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: msg, data: currentData})
            });
            const d = await r.json();
            addRatMsg(d.reply);
        }
        function addRatMsg(txt) {
            const win = document.getElementById('chat-window');
            win.innerHTML += `<div class="rat-msg"><b>CYBER_RAT:</b> ${txt}</div>`;
            win.scrollTop = win.scrollHeight;
        }
    </script>
</body>
</html>
