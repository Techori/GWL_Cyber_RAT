<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GWL CYBER RAT | Modern Intelligence Portal</title>
    <style>
        :root { --bg: #030508; --card: rgba(13, 17, 23, 0.8); --accent: #007bff; --text: #e6edf3; --border: #30363d; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
        .dashboard { display: flex; height: 100vh; padding: 10px; gap: 10px; box-sizing: border-box; }
        
        /* Left: Intelligence (2/3) */
        .intel-panel { width: 66%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; padding: 20px; }
        /* Right: AI Assistant (1/3) */
        .ai-panel { width: 34%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        input { background: #000; border: 1px solid var(--border); color: var(--accent); padding: 12px; border-radius: 6px; width: 70%; }
        button { background: var(--accent); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        
        #chat-box { flex-grow: 1; padding: 15px; overflow-y: auto; font-size: 14px; }
        .msg { margin-bottom: 12px; padding: 10px; border-radius: 8px; max-width: 85%; }
        .rat { background: #161b22; border-left: 3px solid var(--accent); }
        .user { background: var(--accent); align-self: flex-end; margin-left: auto; }
        
        #data-view { background: #0d1117; padding: 15px; border-radius: 8px; border: 1px solid var(--border); overflow-y: auto; height: 400px; color: #00ff41; font-family: monospace; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="intel-panel">
            <div class="header">
                <h2 style="margin:0;">GWL <span style="color:var(--accent);">CYBER RAT</span></h2>
                <div style="font-size: 12px; color: gray;">CORE_STATUS: <span style="color:green;">ONLINE</span></div>
            </div>
            <div style="text-align:center; margin-bottom:20px;">
                <input type="text" id="target" placeholder="Enter tracking ID or Mobile...">
                <button onclick="runIntel()">Initialize</button>
            </div>
            <div id="data-view">Waiting for signal...</div>
        </div>
        
        <div class="ai-panel">
            <div style="padding:15px; border-bottom:1px solid var(--border); font-weight:bold;">CYBER RAT AI</div>
            <div id="chat-box">
                <div class="msg rat">Neural link established. I am <b>Cyber Rat</b>. Ready for analysis.</div>
            </div>
            <div style="padding:10px; display:flex; gap:5px;">
                <input type="text" id="chat-input" style="flex-grow:1;" placeholder="Ask AI...">
                <button onclick="askAI()" style="padding:10px;">Send</button>
            </div>
        </div>
    </div>

    <script>
        let lastData = null;
        async function runIntel() {
            const q = document.getElementById('target').value;
            const view = document.getElementById('data-view');
            view.innerText = "[*] Accessing Nodes...";
            const fd = new FormData(); fd.append('query', q);
            const r = await fetch('/search', {method:'POST', body:fd});
            const d = await r.json();
            if(d.status === "success") {
                lastData = d.data;
                view.innerText = JSON.stringify(d.data, null, 4);
                addChat("Target located. Analysis stream open.");
            } else { view.innerText = d.msg; }
        }

        async function askAI() {
            const inp = document.getElementById('chat-input');
            const box = document.getElementById('chat-box');
            if(!inp.value) return;
            box.innerHTML += `<div class="msg user">${inp.value}</div>`;
            const msg = inp.value; inp.value = "";
            const r = await fetch('/ask_rat', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({message: msg, data: lastData})
            });
            const d = await r.json();
            addChat(d.reply);
        }

        function addChat(t) {
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="msg rat"><b>Cyber Rat:</b> ${t}</div>`;
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
