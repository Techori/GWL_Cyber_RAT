<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GWL CYBER RAT | Intelligence Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg: #05070a; --panel: #0d1117; --accent: #ffb400; --text: #e6edf3; --border: #30363d;
        }
        .light-theme {
            --bg: #fff5f7; --panel: #ffffff; --accent: #ff4d6d; --text: #1a1a1a; --border: #ffccd5;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; overflow: hidden; }
        
        /* 1. Animated Welcome */
        #welcome-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background:#000;
            display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;
            animation: fadeOut 3s forwards 3.5s;
        }
        .glitch { font-size: 3rem; font-weight: bold; color: var(--accent); letter-spacing: 5px; overflow: hidden; white-space: nowrap; border-right: 4px solid var(--accent); width: 0; animation: typing 2.5s steps(30, end) forwards; }
        
        /* 2. Header & Theme Toggle */
        .top-bar { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; background: var(--panel); }
        .theme-btn { padding: 8px 15px; border: 1px solid var(--accent); background: transparent; color: var(--accent); cursor: pointer; border-radius: 4px; font-weight: bold; }

        /* 3. Main Dashboard Layout (2:3 Split) */
        .dashboard { display: flex; height: calc(100vh - 60px); }
        .left-data-panel { width: 66.6%; padding: 30px; border-right: 1px solid var(--border); overflow-y: auto; background: var(--bg); }
        .right-ai-panel { width: 33.3%; display: flex; flex-direction: column; background: var(--panel); }

        /* 4. Search UI */
        .search-container { text-align: center; margin: 20px 0 40px 0; }
        .input-group { position: relative; display: inline-block; width: 80%; }
        input[type="text"] { width: 100%; padding: 15px 20px; background: #000; border: 1px solid var(--border); color: var(--accent); font-size: 16px; border-radius: 8px; box-sizing: border-box; }
        .execute-btn { margin-top: 15px; padding: 12px 40px; background: var(--accent); color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; text-transform: uppercase; }

        /* 5. Results & Filters */
        .results-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 20px; display: none; }
        .filter-bar { display: flex; justify-content: space-between; margin-bottom: 15px; }
        #report-box { background: #000; padding: 15px; border-radius: 4px; overflow: auto; max-height: 400px; color: #00ff41; font-family: monospace; border: 1px solid #1f2328; }

        /* 6. Cyber Rat AI Chat */
        .chat-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: bold; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        #chat-msgs { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg-bubble { max-width: 85%; padding: 10px 15px; border-radius: 8px; line-height: 1.4; font-size: 14px; }
        .user-msg { align-self: flex-end; background: var(--accent); color: #000; }
        .rat-msg { align-self: flex-start; background: #1f2328; color: var(--text); border: 1px solid var(--border); }
        .chat-input { padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
    </style>
</head>
<body>

<div id="welcome-overlay">
    <div class="glitch">WELCOME TO GWL CYBER RAT</div>
    <p style="color:#555; margin-top:20px;">[ ESTABLISHING SECURE UPLINK... ]</p>
</div>

<div class="top-bar">
    <div style="font-weight:bold; letter-spacing:2px;">GWL <span style="color:var(--accent);">CYBER RAT</span></div>
    <button class="theme-btn" onclick="document.body.classList.toggle('light-theme')">TOGGLE THEME</button>
</div>

<div class="dashboard">
    <div class="left-data-panel">
        <div class="search-container">
            <div class="input-group">
                <input type="text" id="target" placeholder="Enter Mobile Number, Email or Tracker ID...">
            </div><br>
            <button class="execute-btn" onclick="startTracking()">Initialize Tracking</button>
        </div>

        <div id="results-container" class="results-card">
            <div class="filter-bar">
                <span>INTEL REPORT</span>
                <div>
                    <button onclick="downloadPDF()" style="background:transparent; color:var(--accent); border:1px solid; cursor:pointer; padding:2px 10px;">Download PDF</button>
                </div>
            </div>
            <input type="text" id="filter" placeholder="Filter data..." style="width:100%; margin-bottom:10px; padding:5px; background:transparent; border:1px solid var(--border); color:var(--text);">
            <pre id="report-box">{}</pre>
        </div>
    </div>

    <div class="right-ai-panel">
        <div class="chat-header">ðŸ¤– CYBER RAT AI ASSISTANT</div>
        <div id="chat-msgs">
            <div class="msg-bubble rat-msg">Hello Manu. I am <b>Cyber Rat</b>. I have established a neural link to the intelligence network. Enter a target to begin surveillance.</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-query" placeholder="Ask Cyber Rat about data..." style="flex-grow:1; background:transparent; border:1px solid var(--border); color:var(--text); padding:10px;">
            <button onclick="sendToRat()" style="background:var(--accent); border:none; padding:0 15px; cursor:pointer; font-weight:bold;">SEND</button>
        </div>
    </div>
</div>

<script>
    async function startTracking() {
        const q = document.getElementById('target').value;
        const resCard = document.getElementById('results-container');
        const report = document.getElementById('report-box');
        if(!q) return;

        report.innerHTML = "[ STEP 1 ] Connecting to Global Node Grid...\n[ STEP 2 ] Accessing Leak Databases...";
        resCard.style.display = 'block';

        const fd = new FormData(); fd.append('query', q);
        const r = await fetch('/search', { method: 'POST', body: fd });
        const d = await r.json();

        if(d.status === "success") {
            report.style.color = "#00ff41";
            report.innerText = JSON.stringify(d.data, null, 4);
            addRatMsg("Surveillance complete. I have successfully retrieved asset data from the intelligence network.");
        } else {
            report.style.color = "#ff4d4d";
            report.innerText = "NO DATA FOUND IN DATABASE.";
            addRatMsg("Target not found. The asset might be using a proxy or encrypted relay.");
        }
    }

    function addRatMsg(text) {
        const win = document.getElementById('chat-msgs');
        win.innerHTML += `<div class="msg-bubble rat-msg"><b>Cyber Rat:</b> ${text}</div>`;
        win.scrollTop = win.scrollHeight;
    }

    function sendToRat() {
        const val = document.getElementById('chat-query').value;
        if(!val) return;
        const win = document.getElementById('chat-msgs');
        win.innerHTML += `<div class="msg-bubble user-msg">${val}</div>`;
        document.getElementById('chat-query').value = "";
        
        setTimeout(() => {
            addRatMsg("Analyzing request... My current logic is synced with the OSINT data feed to provide real-time intelligence.");
        }, 800);
    }

    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("courier");
        doc.text("GWL CYBER RAT - INTELLIGENCE REPORT", 10, 10);
        doc.text(document.getElementById('report-box').innerText.substring(0, 1000), 10, 20);
        doc.save("CyberRat_Intelligence.pdf");
    }
</script>
</body>
</html>
